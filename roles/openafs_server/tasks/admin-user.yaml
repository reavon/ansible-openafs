---
- name: Ensure the admin user exists
  command: pts createuser -name {{ openafs_admin }} -localauth
  register: pts_result
  ignore_errors: true
  changed_when: pts_result.rc == 0

- fail:
    msg: Unable to create admin user.
  when: >
    pts_result.rc != 0
    and not 'Entry for name already exists' in pts_result.stderr

- name: Add admin user to system:administrators group
  command: pts adduser {{ openafs_admin }} system:administrators -localauth
  register: pts_result
  ignore_errors: true
  changed_when: pts_result.rc == 0

- fail:
    msg: Unable to add admin user to admin group.
  when: >
    pts_result.rc != 0
    and not 'Entry for id already exists' in pts_result.stderr
